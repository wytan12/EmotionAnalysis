# Squid configuration for RDC proxy
http_port 3128

# Allow access from the backend container
acl localnet src 172.16.0.0/12    # Docker networks
acl localnet src 192.168.0.0/16   # Docker networks
acl localnet src 10.0.0.0/8       # Docker networks

# SSL/HTTPS support
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl CONNECT method CONNECT

# Allow RDC domains
acl rdc_domains dstdomain .rdc.nie.edu.sg
acl rdc_domains dstdomain kf6.rdc.nie.edu.sg

# Allow HTTPS CONNECT to RDC domains
http_access allow CONNECT rdc_domains

# Access rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
http_access allow rdc_domains
http_access deny all
http_access allow CONNECT SSL_ports

# Cache configuration
cache_dir ufs /var/spool/squid 100 16 256
coredump_dir /var/spool/squid

# Logging
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log

# Headers
forwarded_for on
via on

# DNS
dns_nameservers 8.8.8.8 8.8.4.4

# Refresh patterns
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
